<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Zone | MN Lotto Club</title>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="icon" href="favicon.png" type="image/png">
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <style>
        /* Member Zone Specific Styles */
        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .auth-container h2 { margin-bottom: 1.5rem; color: #1e293b; }
        
        .form-group { margin-bottom: 1rem; text-align: left; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: #64748b; }
        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1rem;
        }

        .btn-primary {
            width: 100%;
            padding: 0.75rem;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-primary:hover { background: #1d4ed8; }

        .error-msg { color: #dc2626; font-size: 0.9rem; margin-top: 1rem; display: none; }

        /* Private Content (Hidden by default) */
        #private-content { display: none; }
        
        .member-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-top: 2rem;
        }
        .member-item {
            display: flex;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f1f5f9;
        }
        .member-item:last-child { border-bottom: none; }
        .status-paid { color: #16a34a; font-weight: 500; }
        .status-pending { color: #ca8a04; font-weight: 500; }

        .constitution-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2rem;
            line-height: 1.6;
        }
    </style>
</head>
<body>

    <!-- Nav -->
    <nav class="top-nav">
        <div class="nav-content">
            <div class="brand">
                <a href="index.html" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 10px;">
                    <img src="logo.png" alt="MN Lotto Club" style="height: 32px; width: 32px;">
                    MN Lotto Club
                </a>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-item">Dashboard</a>
                <a href="#" id="logout-btn" class="nav-item" style="display: none;">Logout</a>
            </div>
        </div>
    </nav>

    <div class="club-container">
        
        <!-- Auth Form (Login/Signup) -->
        <div id="login-form" class="auth-container">
            <h2 id="form-title"><i class="fa-solid fa-lock"></i> Member Access</h2>
            <form id="auth-form">
                <div class="form-group" id="name-group" style="display: none;">
                    <label>Full Name</label>
                    <input type="text" id="full-name" placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="email" required placeholder="member@example.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" required placeholder="••••••••">
                </div>
                <div class="form-group" id="code-group" style="display: none;">
                    <label>Club Access Code</label>
                    <input type="text" id="access-code" placeholder="Enter provided code">
                </div>
                <button type="submit" class="btn-primary" id="submit-btn">Sign In</button>
                <p id="error-message" class="error-msg"></p>
            </form>
            <p style="margin-top: 1.5rem; font-size: 0.9rem; color: #64748b;">
                <span id="toggle-text">Don't have an account?</span> 
                <a href="#" id="toggle-auth" style="color: #2563eb; font-weight: 600; text-decoration: none;">Sign Up</a>
            </p>
        </div>

        <!-- Private Content -->
        <div id="private-content">
            <div class="section-header">
                <h2>Welcome, <span id="user-name">Member</span></h2>
                <p>Official 2026 Club Roster & Documents</p>
            </div>

            <!-- Member List -->
            <div class="member-list">
                <div class="member-item" style="background: #f8fafc; font-weight: 600;">
                    <span>Member Name</span>
                    <span>Status</span>
                </div>
                <!-- Example Data (Will be replaced by Firebase data) -->
                <div class="member-item">
                    <span>Cody Carlson (Commissioner)</span>
                    <span class="status-paid"><i class="fa-solid fa-check"></i> Paid</span>
                </div>
                <div class="member-item">
                    <span>John Doe</span>
                    <span class="status-paid"><i class="fa-solid fa-check"></i> Paid</span>
                </div>
                <div class="member-item">
                    <span>Jane Smith</span>
                    <span class="status-pending"><i class="fa-regular fa-clock"></i> Pending</span>
                </div>
            </div>

            <!-- Constitution -->
            <div class="constitution-card">
                <h3><i class="fa-solid fa-file-contract"></i> Minnesota Millionaires Lottery Club Agreement</h3>
                <p class="draw-date" style="color: var(--text-muted); margin-bottom: 20px;">Effective 3-1-24 thru 2-28-25</p>
                
                <div style="line-height: 1.6; color: var(--text-dark);">
                    <p><strong>Administrator/Treasurer:</strong> Al Harvath</p>
                    
                    <h4 style="margin-top: 20px;"><i class="fa-solid fa-users"></i> 2024 Club Members</h4>
                    <p style="font-size: 0.95em; color: var(--text-muted);">
                        Donna Anderson, Steve Bast, Justin Berry, Paul Bird, Jim Brown, Chuck Capesius, Cody Carlson, Davon Cook, Dustin Engelke, Ernest Fluette, Harold Forslund, Al Harvath, Barb Harvath, Brian Harvath, Sam Harvath, Jim Hovde (2 shares), Steve Jaster, Zack Kiefer, Bao Le, Carlos Leon, Bryan Lindberg, Craig Masteller, Tracy Olson-Patterson, Larry Proechel, Faye Radtke, Tom Riesgraf, Lori Rock, Jeff Ryan, Mark Santana, Jon Schneider, Brad Schultz, Kurt Schroeder, Bob Sromek, Ken Stassen, Glen Swanson, Patti Swanson, Jim Taklor, Paul Teneyck, Thai Thammarak, Dave Wagener, Mark Wagner, Peggy Wecker, Tom Weckman, Mary Yang.
                    </p>

                    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #e2e8f0;">

                    <h4 style="margin-top: 20px;"><i class="fa-solid fa-list-ol"></i> Our Numbers</h4>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>Powerball (10 Plays):</strong><br>
                        13-21-35-66-68 (26) &bull; 01-09-22-38-44-45 (26) &bull; 05-03-15-16-23-37 (26) &bull; 08-09-25-32-56-59 (26) &bull; 09-03-08-29-36-41 (26)<br>
                        11-20-36-45-46-51 (26) &bull; 13-12-13-31-56-69 (26) &bull; 15-01-02-09-11-19 (26) &bull; 17-09-12-32-33-40 (26) &bull; 22-08-17-19-26-49 (26)
                    </div>

                    <div style="margin-bottom: 15px;">
                        <strong>Mega Millions (10 Plays):</strong><br>
                        04-18-25-36-55 (25) &bull; 01-03-06-07-23-27 (25) &bull; 04-08-21-40-51-53 (25) &bull; 08-16-29-38-45-54 (25) &bull; 10-09-18-29-49-51 (25)<br>
                        14-01-09-20-24-30 (25) &bull; 16-04-09-22-30-48 (25) &bull; 18-50-61-63-65-68 (25) &bull; 20-09-17-41-44-68 (25) &bull; 22-21-28-56-66-69 (25)
                    </div>

                    <div>
                        <strong>Lotto America (4 Plays):</strong><br>
                        01-22-25-32-45 (10) &bull; 02-17-22-25-44-45 (10) &bull; 04-07-28-47-48-51 (10) &bull; 09-32-38-40-41-50 (10)
                    </div>

                    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #e2e8f0;">

                    <h4 style="margin-top: 20px;"><i class="fa-solid fa-gavel"></i> Club Rules</h4>
                    
                    <p><strong>Administration:</strong> The club is run by Al Harvath; he is the club administrator & treasurer.</p>

                    <p><strong>Membership:</strong> The club membership consists of the 44 individuals listed above. This agreement runs from March 1st 2024 thru February 28th 2025. In the event of the death of a member his/her spouse will be allowed to replace the member, they will simply assume the deceased members place in the club. If the spouse does not wish to join or the member was unmarried, the member's estate will receive its share of winnings the same as other members. If there are no winnings to be paid out to all club members, the membership will be allowed to run out & no refund will be made.</p>

                    <p><strong>Dues:</strong> Members will pay dues of $120.00 annually for each share in the club they wish to purchase, multiple shares are allowed. Dues are to be paid by February 10th each year. Payment received after this date may be returned and the individual would then have to wait to apply the following year for membership. Dues are to be paid by check/money order only (made out to "Al Harvath"). There will be NO refunds of dues paid. Payment in advance of Feb 10th (but after January 1st) is encouraged, but this does not give the member a greater share of winnings. The individual member is responsible to remember to pay dues on time for the coming year.</p>

                    <p><strong>Winnings:</strong> Winnings on any ticket $10,000 and over will be divided equally among all members based on shares purchased. The club will simply retain winnings under $10,000. Members do not have an equity stake in the club. (No equity paid when joining -- none paid when getting out)</p>

                    <p><strong>Expenses:</strong> Expenses will be paid by the treasurer Al Harvath as needed from the club's funds. The club pays him a monthly fee of $10.00 for maintaining club books & monthly copies of tickets & other personal expenses related to the club. All other expenses like correspondence with members will be paid for separately with club funds. The treasurer will maintain a log of dues paid & funds spent. The treasurer will provide each member a year-end financial report no later than 90 days after the year ends on February 28th.</p>

                    <p><strong>Numbers:</strong> Members may request a set of numbers to be played - however the club administrator reserves the right to make the final decision on which numbers are purchased. Except for unusual circumstances numbers will only be changed March 1st each year with the new agreement. The club treasurer shall purchase the (10) designated Powerball numbers (Drawing on Monday, Wednesday & Saturday), (10) Mega Millions numbers (Drawing on Tuesday & Friday) and (4) Lotto America numbers (Drawing on Monday, Wednesday & Saturday) for each drawing. The treasurer shall not be liable for unintentional omissions or errors in ticket or number purchases. All Powerball, Mega Millions & Lotto America tickets or payoff stubs (along with photocopies of all tickets) shall be kept by the treasurer for a minimum of (1) year from the date of the drawing they are for. Any Powerball, Mega Millions & Lotto America numbers (tickets) that are purchased by individual club members on their own are NOT the club's property & any winnings they create belong to that club member.</p>
                </div>
            </div>
        </div>

    </div>

    <!-- Firebase Logic -->
    <script type="module">
        import { auth, db, signInWithEmailAndPassword, signOut, onAuthStateChanged } from './config/firebase-config.js';
        import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { collection, getDocs, query, setDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const loginForm = document.getElementById('login-form');
        const authForm = document.getElementById('auth-form');
        const privateContent = document.getElementById('private-content');
        const logoutBtn = document.getElementById('logout-btn');
        const errorMsg = document.getElementById('error-message');
        const memberListContainer = document.querySelector('.member-list');
        
        const toggleAuth = document.getElementById('toggle-auth');
        const toggleText = document.getElementById('toggle-text');
        const formTitle = document.getElementById('form-title');
        const submitBtn = document.getElementById('submit-btn');
        const nameGroup = document.getElementById('name-group');
        const codeGroup = document.getElementById('code-group');

        let isLogin = true;
        const ACCESS_CODE = "MNMILLIONAIRES2026"; // You can change this code

        // Toggle Login/Signup
        toggleAuth.addEventListener('click', (e) => {
            e.preventDefault();
            isLogin = !isLogin;
            
            formTitle.innerHTML = isLogin ? '<i class="fa-solid fa-lock"></i> Member Access' : '<i class="fa-solid fa-user-plus"></i> Join the Club';
            submitBtn.innerText = isLogin ? 'Sign In' : 'Create Account';
            toggleText.innerText = isLogin ? "Don't have an account?" : "Already have an account?";
            toggleAuth.innerText = isLogin ? "Sign Up" : "Sign In";
            
            nameGroup.style.display = isLogin ? 'none' : 'block';
            codeGroup.style.display = isLogin ? 'none' : 'block';
            errorMsg.style.display = 'none';
        });

        // Check Auth State
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                loginForm.style.display = 'none';
                privateContent.style.display = 'block';
                logoutBtn.style.display = 'inline-block';
                document.getElementById('user-name').innerText = user.email.split('@')[0];
                await loadMembers();
            } else {
                loginForm.style.display = 'block';
                privateContent.style.display = 'none';
                logoutBtn.style.display = 'none';
            }
        });

        async function loadMembers() {
            memberListContainer.innerHTML = `
                <div class="member-item" style="background: #f8fafc; font-weight: 600;">
                    <span>Member Name</span>
                    <span>Status</span>
                </div>
                <div class="member-item" style="justify-content: center; padding: 2rem; color: #64748b;" id="loading-spinner">
                    <i class="fa-solid fa-spinner fa-spin"></i> Loading Roster...
                </div>
            `;

            try {
                const querySnapshot = await getDocs(collection(db, "members"));
                const spinner = document.getElementById('loading-spinner');
                if (spinner) spinner.remove();

                if (querySnapshot.empty) {
                    memberListContainer.innerHTML += `<div class="member-item">No members found.</div>`;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const member = doc.data();
                    const name = member.name || "Unknown Member";
                    const status = member.status || "Pending";
                    const role = member.role || "";

                    let statusHtml = (status.toLowerCase() === 'paid') 
                        ? `<span class="status-paid"><i class="fa-solid fa-check"></i> Paid</span>`
                        : `<span class="status-pending"><i class="fa-regular fa-clock"></i> ${status}</span>`;

                    const row = document.createElement('div');
                    row.className = 'member-item';
                    row.innerHTML = `
                        <span>
                            ${name} 
                            ${role ? `<span style="font-size:0.8em; background:#e2e8f0; padding:2px 6px; border-radius:4px; margin-left:8px;">${role}</span>` : ''}
                        </span>
                        ${statusHtml}
                    `;
                    memberListContainer.appendChild(row);
                });
            } catch (error) {
                console.error("Error loading members:", error);
            }
        }

        // Handle Form Submit
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            errorMsg.style.display = 'none';

            if (isLogin) {
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    errorMsg.innerText = "Invalid email or password.";
                    errorMsg.style.display = 'block';
                }
            } else {
                // Signup Logic
                const fullName = document.getElementById('full-name').value;
                const code = document.getElementById('access-code').value;

                if (!fullName) {
                    errorMsg.innerText = "Please enter your full name.";
                    errorMsg.style.display = 'block';
                    return;
                }

                if (code !== ACCESS_CODE) {
                    errorMsg.innerText = "Invalid Club Access Code.";
                    errorMsg.style.display = 'block';
                    return;
                }

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;

                    // Create member record in Firestore
                    await setDoc(doc(db, "members", user.uid), {
                        name: fullName,
                        status: "Pending",
                        role: "Member",
                        email: email,
                        joinedAt: new Date().toISOString()
                    });

                    console.log("Member created successfully!");
                } catch (error) {
                    errorMsg.innerText = error.message;
                    errorMsg.style.display = 'block';
                }
            }
        });

        logoutBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            await signOut(auth);
        });
    </script>
</body>
</html>